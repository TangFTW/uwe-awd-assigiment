<div class="search-container">
  <header class="search-header">
    <div>
      <h1>Search Mobile Post Offices</h1>
      <p>Find mobile post offices across Hong Kong</p>
    </div>
    <button class="btn-close" type="button" (click)="close()">Close</button>
  </header>

  <!-- Search Mode Selector -->
  <div class="mode-selector">
    <button [class.active]="searchMode === 'district'" (click)="searchMode = 'district'">
      District
    </button>
    <button [class.active]="searchMode === 'day'" (click)="searchMode = 'day'">
      Day of Week
    </button>
    <button [class.active]="searchMode === 'location'" (click)="searchMode = 'location'">
      Location
    </button>
    <button [class.active]="searchMode === 'address'" (click)="searchMode = 'address'">
      Address
    </button>
    <button [class.active]="searchMode === 'advanced'" (click)="searchMode = 'advanced'">
      Advanced Search
    </button>
  </div>

  <!-- Search Form -->
  <form class="search-form" [formGroup]="searchForm" (ngSubmit)="onSearch()">
    <!-- District Search -->
    @if (searchMode === 'district') {
    <div class="form-group">
      <label for="district">District (EN)</label>
      <input
        id="district"
        type="text"
        formControlName="districtInput"
        placeholder="e.g. Tsuen Wan, Sai Kung"
        class="form-input"
      />
    </div>
    }

    <!-- Day of Week Search -->
    @if (searchMode === 'day') {
    <div class="form-group">
      <label for="day">Day of Week (1-7)</label>
      <input
        id="day"
        type="number"
        formControlName="dayInput"
        min="1"
        max="7"
        placeholder="1=Mon, 7=Sun"
        class="form-input"
      />
    </div>
    }

    <!-- Location Search -->
    @if (searchMode === 'location') {
    <div class="form-group">
      <label for="location">Location (EN)</label>
      <input
        id="location"
        type="text"
        formControlName="locationInput"
        placeholder="e.g. Sham Tseng, Pui O"
        class="form-input"
      />
    </div>
    }

    <!-- Address Search -->
    @if (searchMode === 'address') {
    <div class="form-group">
      <label for="address">Address (EN)</label>
      <input
        id="address"
        type="text"
        formControlName="addressInput"
        placeholder="e.g. Castle Peak Road"
        class="form-input"
      />
    </div>
    }

    <!-- Advanced Search -->
    @if (searchMode === 'advanced') {
    <div class="form-group">
      <label for="advDistrict">District (EN)</label>
      <input
        id="advDistrict"
        type="text"
        formControlName="districtInput"
        name="advDistrict"
        placeholder="e.g. Tsuen Wan"
        class="form-input"
      />
    </div>
    <div class="form-group">
      <label for="advLocation">Location (EN)</label>
      <input
        id="advLocation"
        type="text"
        formControlName="locationInput"
        placeholder="e.g. Sham Tseng"
        class="form-input"
      />
    </div>
    <div class="form-group">
      <label for="advAddress">Address (EN)</label>
      <input
        id="advAddress"
        type="text"
        formControlName="addressInput"
        placeholder="e.g. Castle Peak Road"
        class="form-input"
      />
    </div>
    <div class="form-group">
      <label for="advDay">Day of Week (1-7, optional)</label>
      <input
        id="advDay"
        type="number"
        formControlName="dayInput"
        min="1"
        max="7"
        placeholder="1=Mon, 7=Sun"
        class="form-input"
      />
    </div>
    <div class="form-group">
      <label for="advMobileCode">Mobile Code (optional)</label>
      <input
        id="advMobileCode"
        type="text"
        formControlName="mobileCodeInput"
        placeholder="e.g. 1, 2"
        class="form-input"
      />
    </div>
    <div class="form-group">
      <label for="advOpenAt">Open at Time (HH:MM, optional)</label>
      <input
        id="advOpenAt"
        type="text"
        formControlName="openAtInput"
        placeholder="e.g. 09:00, 14:30"
        class="form-input"
      />
      <small style="color: #6b7280; font-size: 0.85em;">Find posts open at this specific time</small>
    </div>
    }

    <button type="submit" class="btn-search">Search</button>
  </form>

  <!-- Results -->
  @if (posts.length > 0) {
  <div class="results-section">
    <h2>Found {{ posts.length }} records</h2>
    <div class="table-container">
      <table class="results-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Mobile Code</th>
            <th>District</th>
            <th>地區</th>
            <th>地区</th>
            <th>Location</th>
            <th>地點</th>
            <th>地点</th>
            <th>Address</th>
            <th>地址</th>
            <th>地址</th>
            <th>Day</th>
            <th>Open</th>
            <th>Close</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (post of posts; track post.id) {
          <tr>
            <td>{{ post.id }}</td>
            <td>{{ post.mobileCode }}</td>
            <td>{{ post.districtEN || '—' }}</td>
            <td>{{ post.districtTC || '—' }}</td>
            <td>{{ post.districtSC || '—' }}</td>
            <td>{{ post.locationEN || '—' }}</td>
            <td>{{ post.locationTC || '—' }}</td>
            <td>{{ post.locationSC || '—' }}</td>
            <td>{{ post.addressEN || '—' }}</td>
            <td>{{ post.addressTC || '—' }}</td>
            <td>{{ post.addressSC || '—' }}</td>
            <td>{{ post.dayOfWeekCode }}</td>
            <td>{{ post.openHour }}</td>
            <td>{{ post.closeHour }}</td>
            <td>
              <button class="btn-view" (click)="onView(post)" title="View Details">View</button>
              <button class="btn-edit" (click)="onEdit(post)" title="Edit">Edit</button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  } @if (posts.length === 0 && searched) {
  <div class="no-results">
    <p>No records found. Try different search criteria.</p>
  </div>
  }
</div>

<!-- View Post Modal -->
@if (showViewModal() && selectedPost()) {
<div class="modal-overlay" (click)="closeViewModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-view-post
      [record]="selectedPost()!"
      (closeModal)="closeViewModal()"
      (editRecord)="onEditFromView($event)"
      (deleteRecord)="onDeleteFromView($event)"
    ></app-view-post>
  </div>
</div>
}

<!-- Update Post Modal -->
@if (showUpdateModal() && selectedPost()) {
<div class="modal-overlay" (click)="closeUpdateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <app-update-post
      [postData]="selectedPost()!"
      (closeModal)="closeUpdateModal()"
    ></app-update-post>
  </div>
</div>
}
